<!DOCTYPE html>
<html lang="en" class="h-100">
  <head>
    <title>LOAN DRAKE: A Coding Project By Harrison Pickett</title>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />

    <!-- FAVICON & APPICON -->
    <link
      rel="apple-touch-icon"
      sizes="57x57"
      href="img/favicon/apple-icon-57x57.png"
    />
    <link
      rel="apple-touch-icon"
      sizes="60x60"
      href="img/favicon/apple-icon-60x60.png"
    />
    <link
      rel="apple-touch-icon"
      sizes="72x72"
      href="img/favicon/apple-icon-72x72.png"
    />
    <link
      rel="apple-touch-icon"
      sizes="76x76"
      href="img/favicon/apple-icon-76x76.png"
    />
    <link
      rel="apple-touch-icon"
      sizes="114x114"
      href="img/favicon/apple-icon-114x114.png"
    />
    <link
      rel="apple-touch-icon"
      sizes="120x120"
      href="img/favicon/apple-icon-120x120.png"
    />
    <link
      rel="apple-touch-icon"
      sizes="144x144"
      href="img/favicon/apple-icon-144x144.png"
    />
    <link
      rel="apple-touch-icon"
      sizes="152x152"
      href="img/favicon/apple-icon-152x152.png"
    />
    <link
      rel="apple-touch-icon"
      sizes="180x180"
      href="img/favicon/apple-icon-180x180.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="192x192"
      href="img/favicon/android-icon-192x192.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="img/favicon/favicon-32x32.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="96x96"
      href="img/favicon/favicon-96x96.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="16x16"
      href="img/favicon/favicon-16x16.png"
    />
    <link rel="manifest" href="img/favicon/manifest.json" />
    <meta name="msapplication-TileColor" content="#ffffff" />
    <meta
      name="msapplication-TileImage"
      content="img/favicon/ms-icon-144x144.png"
    />
    <meta name="theme-color" content="#ffffff" />
    <!--[if IE
      ]><link
        rel="shortcut icon"
        href="img/favicon/favicon.ico"
        type="image/x-icon"
    /><![endif]-->
    <!-- /FAVICON & APPICON -->

    <link
      rel="stylesheet"
      href="../node_modules/bootstrap/dist/css/bootstrap.css"
    />
    <link
      rel="stylesheet"
      href="../node_modules/@fortawesome/fontawesome-free/css/all.css"
    />
    <link rel="stylesheet" href="../node_modules/@fontsource/rakkas/400.css" />
    <link rel="stylesheet" href="css/prism.css" />
    <link rel="stylesheet" href="css/site.css" />
  </head>

  <body class="d-flex flex-column h-100">
    <!-- ==== Nav Section ==== -->
    <nav class="navbar navbar-expand-md navbar-dark fixed-top">
      <div class="container-fluid">
        <a
          class="navbar-brand"
          target="_blank"
          href="https://harrisonpickett.dev"
          ><img
            src="img/brand/logo-light.png"
            class="d-inline-block align-text-top"
            alt="HAP Logo"
            height="28"
        /></a>
        <a class="navbar-brand textLogo mt-1" href="index.html">LOAN DRAKE</a>
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarCollapse"
          aria-controls="navbarCollapse"
          aria-expanded="false"
          aria-label="Toggle navigation"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarCollapse">
          <ul class="navbar-nav me-auto mb-2 mb-md-0">
            <li class="nav-item">
              <a class="nav-link" href="index.html">Home</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="app.html">The App</a>
            </li>
            <li class="nav-item">
              <a class="nav-link active" aria-current="page" href="code.html"
                >The Code</a
              >
            </li>
            <li class="nav-item">
              <a
                class="nav-link"
                target="_blank"
                href="https://github.com/harrisonapickettiv/loandrake"
                >Git Repo</a
              >
            </li>
            <li class="nav-item">
              <a
                class="nav-link"
                target="_blank"
                href="https://harrisonpickett.dev"
                >About</a
              >
            </li>
          </ul>
        </div>
      </div>
    </nav>
    <!-- ==== Main Section ==== -->
    <main class="flex-shrink-0">
      <div class="container px-4 py-5 mt-5">
        <h2 class="border-1 border-bottom border-dark">
          The Code for LOAN DRAKE
        </h2>
        <div class="row row-cols-1 row-cols-lg-2">
          <div class="col-lg-8">
            <pre class="line-numbers">
              <code class="language-javascript">
                const hideElement = (element) => {
                  element.setAttribute("hidden", true);
                  element.setAttribute("aria-hidden", true);
                };
                
                const showElement = (element) => {
                  element.removeAttribute("hidden");
                  element.removeAttribute("aria-hidden");
                };
                
                const resetDisplay = () => {
                  document.getElementById("resultTable").innerHTML = "";
                  hideElement(document.getElementById("errorMsg"));
                };
                
                const displayError = () => {
                  showElement(document.getElementById("errorMsg"));
                };
                
                const toDollars = (n) => {
                  return "$" + n.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",");
                };
                
                const getValues = () => {
                  const amount = parseFloat(document.getElementById("loanAmount").value);
                  const term = parseFloat(document.getElementById("loanTerm").value);
                  const rate = parseFloat(document.getElementById("loanInterest").value);
                
                  const error = isNaN(amount) || isNaN(term) || isNaN(rate);
                
                  return { error, amount, term, rate };
                };
                
                const getPaymentDetails = (payment, rate, remBalance) => {
                  const interest = remBalance * (rate / 1200);
                  const principal = payment - interest;
                  const balance = remBalance - principal;
                
                  return {
                    payment,
                    interest,
                    principal,
                    balance,
                  };
                };
                
                const calculateLoan = (amount, term, rate) => {
                  const payment = (amount * (rate / 1200)) / (1 - (1 + rate / 1200) ** -term);
                  let remainBalance = amount;
                  let totalInterest = 0;
                
                  const loanData = [];
                  for (let month = 1; month <= term; month++) {
                    const paymentDetails = getPaymentDetails(payment, rate, remainBalance);
                    remainBalance = paymentDetails.balance;
                    totalInterest += paymentDetails.interest;
                    loanData.push({ ...paymentDetails, totalInterest, month });
                  }
                
                  return loanData;
                };
                
                const makeTableRows = (loanData) => {
                  let html = "";
                  for (const {
                    month,
                    payment,
                    principal,
                    interest,
                    totalInterest,
                    balance,
                  } of loanData) {
                    // prismjs doesn't play nice with template literals
                    // view the code on github with the link in the navigation bar
                    html += `
                    <tr>
                      <td>${month}</td>
                      <td>${payment.toFixed(2)}</td>
                      <td>${principal.toFixed(2)}</td>
                      <td>${interest.toFixed(2)}</td>
                      <td>${totalInterest.toFixed(2)}</td>
                      <td>${balance.toFixed(2)}</td>
                    </tr>
                  `;
                  }
                  return html;
                };
                
                const displayResult = (loanData, totalPrincipal) => {
                  const { totalInterest, payment: monthlyPayment } =
                    loanData[loanData.length - 1];
                
                  document.getElementById("payment").innerHTML = toDollars(monthlyPayment);
                  document.getElementById("principal").innerHTML = toDollars(totalPrincipal);
                  document.getElementById("interest").innerHTML = toDollars(totalInterest);
                  document.getElementById("cost").innerHTML = toDollars(
                    totalPrincipal + totalInterest
                  );
                
                  document.getElementById("resultTable").innerHTML = makeTableRows(loanData);
                
                  showElement(document.getElementById("result"));
                  hideElement(document.getElementById("instructions"));
                };
                
                const loanDrake = () => {
                  resetDisplay();
                  const { error, amount, term, rate } = getValues();
                  if (error) return displayError();
                  const loanData = calculateLoan(amount, term, rate);
                  displayResult(loanData, amount);
                };
                
              </code>
            </pre>
          </div>
          <div class="col-lg-4">
            <p>
              The code is structured as several functions with a primary
              controller exported to the application.
            </p>
            <h5>Hide Element</h5>
            <p>
              A function that takes an element id and hides that element from
              view.
            </p>
            <h5>Show Element</h5>
            <p>
              A function that takes an element id and reveals that element to
              the user.
            </p>
            <h5>Reset Display</h5>
            <p>
              A function that resets critical components of the display to
              ensure correct viewing by hiding the error and results elements.
            </p>
            <h5>Display Error</h5>
            <p>
              A function that reveals an error message hidden from view. The
              message indicates that user must enter a Loan Amount, Loan Term,
              and Interest Rate.
            </p>
            <h5>To Dollars</h5>
            <p>
              A function that takes a number and returns the a string of the
              number formatted as a US Dollar value.
            </p>
            <h5>Get Values</h5>
            <p>
              A function that gets the value of "loanAmount", "loanTerm", and
              "loanInterest" from the user interface. Returns the values and
              whether they are valid input.
            </p>
            <h5>Get Payment Details</h5>
            <p>
              A function that takes the monthly payment, loan rate, and
              remaining balance. Returns amounts paid to interest and principal,
              along with the remaining balance of the loan.
            </p>
            <h5>Calculate Loan</h5>
            <p>
              A function that takes the total amount of the loan, the total
              months in the term, and the interest rate. Returns an array of
              details for each montly payment of the loan. Details include
              monthly payment amount, interest paid during period, principal
              paid during period, remaining balance after payment, and total
              interest paid to date.
            </p>
            <h5>Make Table Rows</h5>
            <p>
              A function that takes an array of data and returns the data
              formatted as an HTML table row.
            </p>
            <h5>Display Result</h5>
            <p>
              A function that takes a monthly payment schedule as an array,
              along with the amount of a loan. Formats and displays the monthly
              payment amount, loan principal, and total interest to be paid,
              along with the total cost of the loan. Calls makeTableRows to
              generate an HTML table of the payment schedule and displays it to
              the user.
            </p>
            <h5>Loan Drake</h5>
            <p>
              The main application function. Calls getValues to get and validate
              user input. Then displays an error if getValues finds an error in
              input. Otherwise, calls calculateLoan followed by displayResult to
              generate and display a message to the user.
            </p>
          </div>
        </div>
      </div>
    </main>
    <!-- ==== Footer Section ==== -->
    <footer class="footer mt-auto py-3">
      <div class="container-fluid">
        <div class="row row-cols-1 row-cols-lg-3 gy-2">
          <div
            class="
              col
              d-flex
              align-items-center
              order-last order-lg-first
              text-light
            "
          >
            <div>
              <span class="text-muted"> &copy;2021</span>
              <a
                class="footer-link text-light"
                target="_blank"
                href="https://harrisonpickett.dev"
                >Harrison Pickett</a
              >
              |
              <a class="footer-link text-light" href="mailto:hpickett@pobox.com"
                >hpickett@pobox.com</a
              >
            </div>
          </div>
          <div
            class="
              col
              d-flex
              align-items-center
              justify-content-start justify-content-lg-center
            "
          >
            <a target="_blank" href="https://harrisonpickett.dev">
              <img
                src="img/brand/brand-light.png"
                alt="Harrison Pickett Brand Image"
                height="24"
              />
            </a>
          </div>
          <div
            class="
              col
              d-flex
              align-items-center
              justify-content-start justify-content-lg-end
            "
          >
            <div class="row">
              <div class="col social">
                <a
                  href="https://www.linkedin.com/in/harrisonapickettiv"
                  target="_blank"
                  ><i class="fab fa-linkedin fa-2x"></i
                ></a>
              </div>
              <div class="col social">
                <a href="https://github.com/harrisonapickettiv" target="_blank"
                  ><i class="fab fa-github fa-2x"></i
                ></a>
              </div>
              <div class="col social">
                <a href="https://twitter.com/hapickettiv" target="_blank"
                  ><i class="fab fa-twitter fa-2x"></i
                ></a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </footer>
  </body>
  <script src="../node_modules/@popperjs/core/dist/cjs/popper.js"></script>
  <script src="../node_modules/bootstrap/dist/js/bootstrap.js"></script>
  <script src="js/prism.js"></script>
  <script src="js/code.js"></script>
</html>
